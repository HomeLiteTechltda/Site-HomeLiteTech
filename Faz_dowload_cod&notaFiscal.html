<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor Online e Checkout</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/dracula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: Arial, sans-serif; display: flex; flex-direction: column; height: 100vh; background-color: #222; color: white; }

        header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background-color: #444; }
        h1 { font-size: 24px; }
        button { padding: 8px 12px; background-color: #007bff; color: white; border: none; cursor: pointer; border-radius: 5px; }
        button:hover { background-color: #0056b3; }

        .container { display: flex; flex: 1; }
        
        .editor-container {
            display: flex; flex-direction: column; width: 50%; background-color: #222; padding: 20px;
        }
        
        .tabs { display: flex; background: #333; }
        .tab { flex: 1; padding: 10px; text-align: center; cursor: pointer; border: 1px solid #444; color: white; }
        .tab.active { background: #555; }

        .CodeMirror { height: auto; flex: 1; background-color: #333; color: white; }
        
        .preview { flex: 1; padding: 10px; background: #f0f0f0; color: #000; overflow: auto; }
        #preview-frame { width: 100%; height: 100%; border: none; }

        footer { background-color: #444; text-align: center; padding: 10px; }

        /* Checkout Container */
        .container-checkout { display: none; height: 100vh; justify-content: center; align-items: center; }
        .checkout-container {
            background-color: #333; padding: 20px; border-radius: 8px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3); width: 400px; text-align: center;
        }
        .product-info, .payment-info { margin-bottom: 20px; }
        input { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: none; }
        .total { margin: 15px 0; font-size: 1.5em; }
        .success-animation { display: none; margin-top: 20px; font-size: 1.2em; }
    </style>
</head>
<body>

    <header>
        <h1>Editor Online</h1>
        <button id="save-button" onclick="goToCheckout()">Salvar e Ir para Checkout</button>
    </header>

    <div class="container">
        <div class="editor-container">
            <div class="tabs">
                <div class="tab active" data-target="html">HTML</div>
                <div class="tab" data-target="css">CSS</div>
                <div class="tab" data-target="js">JS</div>
            </div>
            <textarea id="html" name="html" placeholder="Escreva seu HTML aqui..."></textarea>
            <textarea id="css" name="css" placeholder="Escreva seu CSS aqui..."></textarea>
            <textarea id="js" name="js" placeholder="Escreva seu JavaScript aqui..."></textarea>
        </div>

        <div class="preview">
            <h2>Preview</h2>
            <iframe id="preview-frame"></iframe>
        </div>
    </div>

    <footer>
        <p>Desenvolvido por vocÃª!</p>
    </footer>

    <!-- Checkout Container -->
    <div class="container-checkout">
        <div class="checkout-container">
            <h1>Checkout</h1>
            <div class="product-info">
                <p><strong>Produto:</strong> Download do cÃ³digo gerado</p>
                <p><strong>Quantidade:</strong> 1</p>
                <p class="total"><strong>Total:</strong> R$300,00</p>
            </div>

            <div class="payment-info">
                <h3>Dados de Pagamento</h3>
                <input type="text" id="card-name" placeholder="Nome no CartÃ£o">
                <input type="text" id="card-number" placeholder="NÃºmero do CartÃ£o">
                <input type="text" id="expiry-date" placeholder="Data de ExpiraÃ§Ã£o (MM/AA)">
                <input type="text" id="cvv" placeholder="CVV">
            </div>

            <button class="purchase-btn" onclick="completePurchase()">Comprar</button>

            <div class="success-animation">
                ðŸŽ‰ Compra realizada com sucesso! ðŸŽ‰
            </div>
        </div>
    </div>

    <!-- Adicionar bibliotecas CodeMirror -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>

    <script>
        // CodeMirror setups
        const htmlEditor = CodeMirror.fromTextArea(document.getElementById('html'), { mode: 'xml', theme: 'dracula', lineNumbers: true });
        const cssEditor = CodeMirror.fromTextArea(document.getElementById('css'), { mode: 'css', theme: 'dracula', lineNumbers: true });
        const jsEditor = CodeMirror.fromTextArea(document.getElementById('js'), { mode: 'javascript', theme: 'dracula', lineNumbers: true });
        const previewFrame = document.getElementById('preview-frame');

        function updatePreview() {
            const html = htmlEditor.getValue();
            const css = `<style>${cssEditor.getValue()}</style>`;
            const js = `<script>${jsEditor.getValue()}<\/script>`;
            const doc = previewFrame.contentDocument || previewFrame.contentWindow.document;
            doc.open();
            doc.write(html + css + js);
            doc.close();
        }

        // Switch Tabs
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                tabs.forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                switchTab(e.target.dataset.target);
            });
        });

        function switchTab(target) {
            [htmlEditor, cssEditor, jsEditor].forEach(editor => {
                editor.getWrapperElement().style.display = 'none';
            });

            switch (target) {
                case 'html':
                    htmlEditor.getWrapperElement().style.display = 'block';
                    break;
                case 'css':
                    cssEditor.getWrapperElement().style.display = 'block';
                    break;
                case 'js':
                    jsEditor.getWrapperElement().style.display = 'block';
                    break;
            }
            updatePreview();
        }

        // Update preview on change
        [htmlEditor, cssEditor, jsEditor].forEach(editor => editor.on('change', updatePreview));

        // Switch to Checkout
        function goToCheckout() {
            document.querySelector('.container').style.display = 'none';
            document.querySelector('.container-checkout').style.display = 'flex';
        }

        // Checkout and download functionalities
        function completePurchase() {
            // Generate Invoice PDF
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            const orderNumber = Math.floor(Math.random() * 1000000);
            const date = new Date().toLocaleDateString();

            pdf.text('Nota Fiscal', 20, 10);
            pdf.text('Produto: Download do cÃ³digo gerado', 20, 20);
            pdf.text('PreÃ§o: R$300,00', 20, 30);
            pdf.text(`Data: ${date}`, 20, 40);
            pdf.text(`NÃºmero do Pedido: ${orderNumber}`, 20, 50);
            pdf.save('nota-fiscal.pdf');

            // Download generated code as a zip file
            setTimeout(() => {
                downloadGeneratedCode();
            }, 1000);

            // Show success message
            document.querySelector('.success-animation').style.display = 'block';

            setTimeout(() => {
                // Redirect to home or refresh
                window.location.reload();
            }, 4000);
        }

        function downloadGeneratedCode() {
            const zip = new JSZip();
            zip.file("index.html", htmlEditor.getValue());
            zip.file("style.css", cssEditor.getValue());
            zip.file("script.js", jsEditor.getValue());
            
            zip.generateAsync({type:"blob"})
            .then(content => {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = 'codigo-gerado.zip';
                link.click();
            });
        }

        // Inicializa a primeira aba
        switchTab('html');
    </script>
</body>
</html>
